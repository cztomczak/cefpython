<!doctype html>
<html>
<head>
	<title>CefAdvanced</title>
	<style>
	body { font: 13px Arial; }
	pre { background: #ddd; }
	</style>
	<script src=ceferror.js></script>
</head>
<body>

Welcome to <b>CEF Python</b> - bindings for the Chromium Embedded Framework.<br>

<br>

Project's website: <a href="http://code.google.com/p/cefpython/">http://code.google.com/p/cefpython/</a><br>
Programming API: <a href="http://code.google.com/p/cefpython/wiki/API">http://code.google.com/p/cefpython/wiki/API</a><br>
Support forum: <a href="https://groups.google.com/group/cefpython?hl=en">https://groups.google.com/group/cefpython?hl=en</a><br>

<br>

navigator.userAgent: <span style="background:#eee"><script>document.write(navigator.userAgent)</script></span><br>

<br>
<span style="color: red">Press F12 key to show developer tools for the main frame.</span>

<br>

<h3>Basic authentication</h3>

<input type=text value="http://127.0.0.1/cefpython/src/tests/httpauthentication.php" size=60 id=httpauth>
<input type=button value="Go" onclick="location.href=httpauth.value">

<br>

<h3>Frame.ExecuteJavascript()</h3>

<textarea id=jscode>alert('test me')</textarea><br>
<a href="javascript:PyExecuteJavascript(jscode.value)">PyExecuteJavascript(jscode.value)</a> - execute javascript from the textarea above.

<h3>Frame.LoadURL(url)</h3>

<a href="javascript:PyLoadURL()">PyLoadURL()</a> - will load "cefsimple.html" into main frame of this window.

<h3>Frames</h3>

<iframe src="cefsimple.html"></iframe>
<iframe src="cefsimple_onloaderror.html"></iframe>

<script>
//frames["simple"].focus()
</script>

<h3>Javascript bindings</h3>

	See output in console for these tests. (Note: "window." is optional, you can just call "PyTest1()")<br>

	<h4>Python version</h4>

	<pre>&lt;script&gt;document.write(window.PyVersion())&lt;/script&gt;</pre>
	<script>document.write(window.PyVersion())</script>	
	<br><br>

	<h4>Passing arguments</h4>

	<a href="javascript:alert('Return value from PyTest1: '+PyTest1(100))">window.PyTest1(100)</a><br>
	<a href="javascript:alert('Return value from PyTest2: '+JSON.stringify(PyTest2(100, 'This string was passed from javascript')))">window.PyTest2(100, 'This string was passed from javascript')</a> - python PyTest2() should return: [1,2, [2.1, {'3': 3, '4': [5,6]}]]
	<br><br>

	<script>var array = [1]; array[100] = 100.01;</script>
	<a href="javascript:PyTest1(array)">window.PyTest1(array)</a> (var array = [1]; array[100] = 100.01;) - the gap is filled with None values.<br>

	<script>var object = {a: 1, '3': 33};</script>
	<a href="javascript:PyTest1(object)">window.PyTest1(object)</a> (var object = {a: 1, '3': 33};)<br>

	<br>
	<script>var nested = [1,2, [3, -4, [5,6, [{7:7, 8: [9,10]}, 11]]]];</script>
	<a href="javascript:PyTest1(nested)">window.PyTest1(nested)</a> (var nested = [1,2, [3, 4, [5,6, [{7:7, 8: [9,10]}, 11]]]];) - dictionary keys will be in a different order in Python.<br>

	<br>
	window.PyConfig = 
	<script>document.write(JSON.stringify(window.PyConfig));</script>
	<br>
	Now change PyConfig: <a href="javascript:window.PyConfig={'option1': false, 'option2': 40}">window.PyConfig={'option1': False, 'option2': 40}</a><br>
	Call __browser.GetMainFrame().GetProperty("PyConfig"): <a href="javascript:PrintPyConfig()">PrintPyConfig()</a><br>
	Try setting PyConfig during runtime using __browser.GetMainFrame().SetProperty(): <a href="javascript:ChangePyConfig()">ChangePyConfig()</a> (then call PrintPyConfig())

	<h4>Infinite recursion</h4>
	Test infinite recursion: <a href="javascript:PyTest1(window)">PyTest1(window)</a> - you will see a python exception in console (also in error.log), data structures can have maximum 8 levels of nesting.

<h3>Javasript callbacks</h3>

<script>
function MyJSCallback(arg1, arg2, arg3, arg4)
{
	alert("MyJSCallback() called\narg1="+JSON.stringify(arg1)+"\narg2="+JSON.stringify(arg2)+"\narg3="+JSON.stringify(arg3)+"\narg4="+JSON.stringify(arg4))
}
function MyJSCallback2()
{
	throw new Error("asd")
}
</script>

<a href="javascript:window.TestJavascriptCallback(MyJSCallback)">window.TestJavascriptCallback(MyJSCallback)</a> - MyJSCallback alerts arguments
<br>
<a href="javascript:window.TestJavascriptCallback(MyJSCallback2)">window.TestJavascriptCallback(MyJSCallback2)</a> - MyJSCallback2 throws new Error("asd")


<h3>Python callbacks</h3>

<script>
function JSCallbackForPythonCallback(pycallback)
{
	pycallback("Calling pycallback via javascript's callback")
}
</script>

<a href="javascript:window.TestPythonCallbackThroughReturn()('some')">window.TestPythonCallbackThroughReturn()('some')</a><br>
<a href="javascript:window.TestPythonCallbackThroughJavascriptCallback(JSCallbackForPythonCallback)">window.TestPythonCallbackThroughJavascriptCallback(JSCallbackForPythonCallback)</a>

<h3>Catching javascript errors programmatically</h3>

<p>Typically when you browse a webpage your javascript errors appear in javascript console in developer tools (in cefadvanced.py there is a binding to F12 key for developer tools).</p>

<p>To catch errors programmatically follow the steps below:</p>

Include "ceferror.js" at the top of your page:
<pre>window.onerror = function(errorMessage, url, lineNumber)
{
	window.PyJavascriptError(errorMessage, url, lineNumber);
	return false;
};</pre>

Also in python create a javascript binding:
<pre>def PyJavascriptError(errorMessage, url, lineNumber):
	raise Exception("%s (in %s on line %s)" % (errorMessage, url, lineNumber))</pre>

<p>Test javascript error: <a href="javascript:Undefined()">Undefined()</a></p>

After clicking application should exit and you should see in the console:
<pre>Exception: Uncaught ReferenceError: Undefined is not defined (in file:///.../cefadvanced.html on
 line 1)</pre>

<h3>Moving and resizing window</h3>

<a href="javascript:PyResizeWindow()">PyResizeWindow()</a> - cefwindow.MoveWindow(__browser.GetWindowID(), width=500, height=500)<br>
<a href="javascript:PyMoveWindow()">PyMoveWindow()</a> - cefwindow.MoveWindow(__browser.GetWindowID(), xpos=0, ypos=0)

<h3>Popups</h3>

	<a href="javascript:window.open('cefsimple.html', '', 'width=600,height=400')">window.open('cefsimple.html')</a><br>
	<a href="javascript:window.open('cefadvanced.html', '', 'width=600,height=400')">window.open('cefadvanced.html')</a>

<h3>Overwriting window.alert()</h3>

<pre>def PyAlert(msg):
	print "PyAlert() called instead of window.alert()"
	win32gui.MessageBox(__browser.GetWindowID(), msg, "PyAlert()")</pre>

<a href="javascript:window.alert('SOME ALERT!')">window.alert('SOME ALERT!')</a>
<br><br>
<pre>def ChangeAlertDuringRuntime():
    __browser.GetMainFrame().SetProperty("alert", PyAlert2)</pre>
<a href="javascript:window.ChangeAlertDuringRuntime()">window.ChangeAlertDuringRuntime()</a> - now check window.alert() above, the messagebox style should be changed.

<h3>Find text on this page</h3>

<pre>def PyFind(searchText, findNext=False):
	__browser.Find(1, searchText, forward=True, matchCase=False, findNext=findNext)</pre>

<input type=text id=searchText value="python"> <input type=button value="window.PyFind()" onclick="window.PyFind(document.getElementById('searchText').value)">

</body>
</html>